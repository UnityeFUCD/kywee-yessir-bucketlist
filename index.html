<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>kywee + yessir bucket list</title>

  <!-- ✅ Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <!-- ✅ App icon + favicon (iOS + browsers) -->
  <link rel="apple-touch-icon" href="/app-icon.png">
  <link rel="icon" type="image/png" href="/app-icon.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Bucket List">

  <link rel="stylesheet" href="styles.css">
  
  <!-- ✅ Supabase JS Client for Realtime Presence (WebSocket) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
  <!-- Marathon Boot Loading Screen -->
  <div class="boot-screen" id="bootScreen">
    <div class="boot-content">
      <div class="boot-title">2026_BUCKET_LIST<span class="boot-version">.EXE</span></div>
      <div class="boot-line"></div>
      <div class="boot-sequence">
        <div class="boot-item" data-delay="0">[▸] INITIALIZING SYSTEM...</div>
        <div class="boot-item" data-delay="400">[▸] ESTABLISHING SYNC PROTOCOL...</div>
        <div class="boot-item" data-delay="800">[▸] CHECKING UESC CREDENTIALS...</div>
        <div class="boot-item" data-delay="1200">[▸] MOUNTING FILE SYSTEMS...</div>
        <div class="boot-item boot-success" data-delay="1600">[*] ALL SYSTEMS OPERATIONAL</div>
        <div class="boot-item boot-ready" data-delay="2000">[*] READY</div>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <span>[▸] 2026 BUCKET_LIST.EXE</span>
      </div>

      <div class="topbar-right">
        <button class="btn hidden" id="btnHome">◂ HOME</button>

        <div class="notif-wrap">
          <div class="notification-bell" id="notificationBell" aria-label="Notifications" title="Notifications">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z"/>
            </svg>
            <span class="notification-badge hidden" id="notificationBadge">0</span>
          </div>

          <div class="notification-dropdown" id="notificationDropdown">
            <div class="notification-header">
              <span>NOTIFICATIONS</span>
              <div class="notif-head-actions">
                <button class="notif-mini-btn" id="btnNotifClearAll" title="Mark all read">
                  <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M7 7h10v2H7V7zm0 4h10v2H7v-2zm0 4h6v2H7v-2z"/>
                  </svg>
                </button>
              </div>
            </div>
            <div id="notificationList"></div>
          </div>
        </div>

        <span class="pill clickable" id="userPill" data-testid="user-pill" title="Click to switch user">
          <i id="userIcon" class="fa-regular fa-user"></i>
          <span class="dot gray" id="userDot"></span>
          <span id="userText" data-testid="current-user">USER: --</span>
        </span>

        <span class="pill clickable" id="duoPill" title="Click to view letters from duo">
          <i id="duoIcon" class="fa-regular fa-user"></i>
          <span class="dot gray" id="duoDot"></span>
          <span id="duoText">DUO: --</span>
        </span>

        <span class="pill" id="syncPill" title="Sync status">
          <span class="dot gray" id="syncDot"></span>
          <span>SYNC</span>
        </span>

        <div class="theme-switcher">
          <button class="btn theme-btn" id="themeBtn">THEME</button>
          <div class="theme-dropdown" id="themeDropdown">
            <div class="theme-option active" data-theme="system">System</div>
            <div class="theme-option" data-theme="light">Light</div>
            <div class="theme-option" data-theme="dark">Dark</div>
            <div class="theme-option" data-theme="christmas">Christmas</div>
          </div>
        </div>
        
        <button class="btn settings-btn" id="settingsBtn" title="Settings"><i class="fas fa-cog"></i></button>
      </div>
    </div>

    <section class="cover" id="cover">

      <div class="corner-decor tl"></div>
      <div class="corner-decor tr"></div>
      <div class="corner-decor bl"></div>
      <div class="corner-decor br"></div>

      <div class="coverInner">
        <svg class="heart" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M12 21s-7.2-4.6-9.7-8.9C.5 8.9 2.1 5.8 5.5 5.1c1.7-.3 3.4.3 4.5 1.6 1.1-1.3 2.8-1.9 4.5-1.6 3.4.7 5 3.8 3.2 7-2.5 4.3-9.7 8.9-9.7 8.9Z"
                fill="currentColor" stroke="currentColor" stroke-width="0.5" style="color: var(--accent);"/>
        </svg>

        <h1 class="big">SYSTEM MESSAGE:<br><span id="herName">MY LOVE</span><span class="cursor"></span></h1>

        <p class="sub">[INITIALIZING...] Our bucket list for the new year. Status: WEADY TO DEPLOY.</p>

        <pre class="emoticon-art" id="dailyEmoticon"></pre>

        <div class="actions" style="justify-content:center; margin-top:30px;">
          <button class="btn primary" id="btnOpen">▸ INITIALIZE SYSTEM</button>
          <button class="btn" id="btnEditSystemMessage">EDIT SYSTEM MESSAGE</button>
        </div>
      </div>
    </section>

    <section class="grid hidden" id="main">
      <div class="card" style="grid-column: 1 / -1;">
        <div class="cardHeader">
          <h2>[▸] 2026 PROGRESS_TRACKER</h2>
          <span class="pill">2026</span>
        </div>
        <div class="cardBody">
          <div class="tracker-grid">
            <div class="tracker-box">
              <div class="tracker-label">CURRENT DATE/TIME</div>
              <div class="tracker-value" id="trackerNow">--</div>
            </div>
            <div class="tracker-box">
              <div class="tracker-label">TIME REMAINING</div>
              <div class="tracker-value" id="trackerRemaining">--</div>
            </div>
            <div class="tracker-box">
              <div class="tracker-label">DAYS ELAPSED</div>
              <div class="tracker-value" id="trackerElapsed">--</div>
            </div>
          </div>
          <div class="tracker-bar" aria-hidden="true">
            <div class="tracker-fill" id="trackerFill"></div>
          </div>
        </div>
      </div>

      <!-- Planning Board Entry Button -->
      <div class="planning-board-entry">
        <button class="btn planning-board-btn" id="openPlanningBoard">
          <span class="pb-icon">▸</span>
          <span class="pb-text">PLANNING_BOARD_2026.EXE</span>
        </button>
        <p class="pb-entry-hint">// Click to open year planning system <span class="pb-beta">*BETA</span></p>
      </div>

      <div class="card">
        <div class="cardHeader">
          <h2>[▸] MISSION_LIST.LOG</h2>

          <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
            <span class="pill" id="yearPill">2026</span>
          </div>
        </div>

        <div class="cardBody">
          <div class="mission-tabs">
            <div class="mission-tab active" data-tab="active">Active Missions</div>
            <div class="mission-tab" data-tab="completed">Completed Missions</div>
          </div>

          <div id="activeTab">
            <div class="note">// STATUS: Items are auto-saved. Check to mark complete.</div>
            <div class="items" id="itemsActive"></div>

            <!-- ✅ Export moved next to Add Saved Mission -->
            <div class="actions actions-inline">
              <button class="btn primary" id="btnAddSaved">ADD SAVED MISSION</button>
              <button class="btn" id="btnDownloadText">EXPORT .TXT</button>
            </div>
          </div>

          <div id="completedTab" class="hidden">
            <div class="note">// COMPLETED: Missions you've finished.</div>
            <div class="items" id="itemsCompleted"></div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="cardHeader">
          <h2>[▸] MESSAGE_LOG</h2>
          <div class="envelope-container" id="envelopeBtn" title="Open latest letter from your DUO">
            <i class="fa-solid fa-envelope" aria-hidden="true"></i>
            <span id="envelopeLabel">DUO</span>
          </div>
        </div>

        <div class="cardBody">
          <p class="note" id="loveNote">// SYSTEM MESSAGE: MY LOVE</p>

          <!-- Big Calendar UI (desktop + mobile) -->
          <div id="bigCalendar" class="calendar"></div>

          <div id="messageLog"></div>

          <div class="form">
            <div class="field">
              <label for="customNote">[▸] NEW MESSAGE</label>
              <textarea id="customNote" placeholder="// Enter your message here..." inputmode="text" autocomplete="off" autocapitalize="sentences"></textarea>
            </div>
            
            <!-- ✅ [FEATURE B] Attachment input -->
            <div class="field attachment-field">
              <label for="attachmentInput"><i class="fas fa-paperclip"></i> ATTACH IMAGE/VIDEO</label>
              <input type="file" id="attachmentInput" accept="image/*,video/*" />
              <div id="attachmentPreview" class="attachment-preview hidden"></div>
            </div>
            
            <button class="btn primary" id="btnSaveNote">SEND LETTER</button>
          </div>

          <hr />

          <div class="field">
            <label>[▸] ADD NEW MISSION</label>
            <input id="newTitle" type="text" placeholder="Movie" inputmode="text">
          </div>
          <div class="field">
            <input id="newDesc" type="text" placeholder="pick a movie and location" inputmode="text">
          </div>
          <div class="field">
            <label for="newTag">TAG</label>
            <select id="newTag">
              <option value="">-- Select Tag --</option>
              <option value="date">date</option>
              <option value="travel">travel</option>
              <option value="cozy">cozy</option>
              <option value="food">food</option>
              <option value="home">home</option>
              <option value="romantic">romantic</option>
              <option value="fun">fun</option>
              <option value="tradition">tradition</option>
              <option value="music">music</option>
              <option value="new">new</option>
              <option value="heart">heart</option>
              <option value="custom">Custom...</option>
            </select>
          </div>
          <div class="field hidden" id="customTagField">
            <input id="customTagInput" type="text" placeholder="Enter custom tag" inputmode="text">
          </div>
          <div class="field">
            <label for="newDueDate"><i class="fas fa-calendar"></i> DUE DATE (OPTIONAL)</label>
            <div class="date-input-wrapper" id="dateInputWrapper">
              <input id="newDueDate" type="date">
            </div>
          </div>
          <div class="actions">
            <button class="btn primary" id="btnAdd">+ ADD MISSION</button>
            <button class="btn" id="btnImportFromPB" title="Import idea from Planning Board">
              <i class="fas fa-download"></i> IMPORT FROM BOARD
            </button>
            <button class="btn" id="btnClearFields">CLEAR FIELDS</button>
          </div>

          <div class="footer">[ COMPILED FOR ONE SPECIAL KITTEN ]</div>
        </div>
      </div>

      <!-- ✅ PHOTO MEMORIES GALLERY -->
      <div class="card">
        <div class="cardHeader">
          <h2>[▸] MEMORIES_GALLERY</h2>
        </div>
        <div class="cardBody">
          <p class="note">// Max 5 photos per mission. Upload multiple times. Unlinked photos = unlimited.</p>
          
          <div class="photo-upload-section">
            <div class="photo-upload-row">
              <input type="file" id="photoInput" accept="image/*,video/*" multiple hidden>
              <button class="btn" id="photoSelectBtn"><i class="fa-solid fa-upload"></i> Select Photos</button>
              <span class="photo-count-hint" id="photoCountHint"></span>
            </div>
            
            <!-- Staging area for photos before submit -->
            <div id="photoStagingArea" class="photo-staging hidden">
              <div class="staging-header">
                <span>Staged: <span id="stagedCount">0</span> photos</span>
                <span class="staging-capacity" id="stagingCapacity"></span>
                <button class="btn btn-small" id="clearStagingBtn">Clear All</button>
              </div>
              <div id="stagingPreview" class="staging-preview"></div>
              
              <div class="photo-upload-options">
                <div class="field">
                  <label for="photoDate"><i class="fas fa-calendar"></i> Date (optional)</label>
                  <input type="date" id="photoDate">
                </div>
                <div class="field">
                  <label for="photoMission"><i class="fa-solid fa-link"></i> Link to Completed Mission</label>
                  <select id="photoMission">
                    <option value="">No mission linked</option>
                  </select>
                  <span class="mission-capacity" id="missionCapacity"></span>
                </div>
              </div>
              
              <button class="btn primary" id="photoSubmitBtn"><i class="fa-solid fa-check"></i> Submit Photos</button>
            </div>
          </div>
          
          <div id="photoGallery" class="photo-gallery">
            <!-- Example bundled photos -->
            <div class="gallery-mission-bundle example-bundle">
              <div class="bundle-header">
                <div class="bundle-header-left" onclick="toggleBundle(this.parentElement)">
                  <span class="bundle-mission"><i class="fa-solid fa-link"></i> Example Date Night</span>
                  <span class="bundle-count">3 photos</span>
                </div>
                <div class="bundle-actions">
                  <span class="bundle-expand" onclick="toggleBundle(this.closest('.bundle-header'))"><i class="fas fa-chevron-down"></i></span>
                </div>
              </div>
              <div class="bundle-photos collapsed">
                <div class="gallery-grid">
                  <div class="gallery-item"><img src="https://placehold.co/200x200/1a1a2e/ff6b9d?text=Photo+1" alt="Example"></div>
                  <div class="gallery-item"><img src="https://placehold.co/200x200/1a1a2e/ff6b9d?text=Photo+2" alt="Example"></div>
                  <div class="gallery-item"><img src="https://placehold.co/200x200/1a1a2e/ff6b9d?text=Photo+3" alt="Example"></div>
                </div>
              </div>
            </div>
            <div class="gallery-empty-note">↑ Click to expand. Your memories will appear below.</div>
          </div>
        </div>
      </div>

      <!-- ✅ MEDAL CLIPS FEED -->
      <div class="card">
        <div class="cardHeader">
          <h2>[▸] GAME_CLIPS</h2>
          <button class="btn" id="refreshMedal" title="Refresh clips"><i class="fa fa-refresh"></i></button>
        </div>
        <div class="cardBody">
          <p class="note">// Our gaming highlights :3</p>
          
          <div id="medalClips" class="medal-grid">
            <div class="medal-empty">Loading clips...</div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <div class="modal" id="savedMissionsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Saved Missions Database</h3>
        <span class="modal-close" id="closeSavedModal">✖</span>
      </div>
      <div id="savedMissionsList"></div>
      <div class="actions">
        <button class="btn primary" id="btnAddSelectedMissions">ADD SELECTED TO ACTIVE</button>
      </div>
    </div>
  </div>

  <div class="letter-modal" id="letterModal">
    <div class="letter-envelope">
      <div class="letter-close" id="closeLetterModal">✖</div>
      <!-- ✅ Navigation for TikTok-style swipe -->
      <div class="letter-nav">
        <button class="letter-nav-btn" id="letterPrev" title="Newer letter">▲</button>
        <span class="letter-counter" id="letterCounter">1 / 1</span>
        <button class="letter-nav-btn" id="letterNext" title="Older letter">▼</button>
      </div>
      <div class="letter-paper">
        <div class="letter-from">FROM: <span id="letterFrom">--</span></div>
        <div class="letter-timestamp" id="letterTimestamp"></div>
        <div class="letter-content" id="letterContent"></div>
        <!-- ✅ Attachment display in letter -->
        <div id="letterAttachment" class="letter-attachment hidden"></div>
        <!-- ✅ Swipe hint INSIDE paper, moves with content -->
        <div class="letter-swipe-hint">↕ SWIPE TO BROWSE LETTERS</div>
      </div>
    </div>
  </div>

  <!-- ✅ [FEATURE B] Fullscreen attachment modal -->
  <div class="modal attachment-modal" id="attachmentModal">
    <div class="attachment-modal-inner">
      <span class="modal-close" id="closeAttachmentModal">✖</span>
      <div id="attachmentModalContent"></div>
    </div>
  </div>

  <!-- ✅ Photo Lightbox Modal -->
  <div class="lightbox-modal" id="photoLightbox">
    <div class="lightbox-close" id="lightboxClose">✖</div>
    <div class="lightbox-nav">
      <button class="lightbox-btn" id="lightboxPrev">◀</button>
      <span class="lightbox-counter" id="lightboxCounter">1 / 1</span>
      <button class="lightbox-btn" id="lightboxNext">▶</button>
    </div>
    <img id="lightboxImage" src="" alt="Photo">
    <div class="lightbox-hint">← Swipe to browse →</div>
  </div>

  <!-- ✅ Medal Clip Modal -->
  <div class="modal medal-modal" id="medalModal">
    <div class="medal-modal-inner">
      <span class="modal-close" id="medalModalClose">✖</span>
      <div id="medalModalContent"></div>
    </div>
  </div>

  <div class="modal" id="whoModal" data-testid="who-modal" aria-hidden="true">
    <div class="modal-content">
      <div class="modal-header">
        <h3>WHO ARE YOU?</h3>
        <span class="modal-close" id="closeWhoModal">✖</span>
      </div>

      <div class="who-grid">
        <button class="who-btn" id="btnWhoYasir" data-testid="login-yasir">
          <span>YASIR</span>
          <span class="itag">USER</span>
        </button>

        <button class="who-btn" id="btnWhoKylee" data-testid="login-kylee">
          <span>KYLEE</span>
          <span class="itag">USER</span>
        </button>
      </div>

      <div class="who-guest-section">
        <button class="who-btn who-btn-guest" id="btnWhoGuest" data-testid="login-guest">
          <span>GUEST</span>
          <span class="itag guest-tag">VIEW ONLY</span>
        </button>
      </div>

      <div class="who-sub">
        This site auto-syncs (system message, missions, messages) across devices.
      </div>

      <div class="who-actions">
        <button class="btn" id="btnLogOff">LOG OFF</button>
      </div>
    </div>
  </div>
  
  <!-- ✅ System message edit modal with character counter -->
  <div class="modal" id="systemMessageModal" aria-hidden="true">
    <div class="modal-content">
      <div class="modal-header">
        <h3>EDIT SYSTEM MESSAGE</h3>
        <span class="modal-close" id="closeSystemMessageModal">✖</span>
      </div>

      <div class="field">
        <label for="systemMessageInput">SYSTEM MESSAGE <span id="charCounter" style="float:right; color: var(--muted);">0 / 30</span></label>
        <input id="systemMessageInput" type="text" maxlength="30" placeholder="My love" autocomplete="off" inputmode="text" />
      </div>

      <div class="actions">
        <button class="btn" id="btnSystemMessageCancel">Cancel</button>
        <button class="btn primary" id="btnSystemMessageSave">Save</button>
      </div>
    </div>
  </div>


  <!-- Settings Modal -->
  <div class="modal" id="settingsModal" aria-hidden="true">
    <div class="modal-inner settings-modal-inner">
      <span class="modal-close" id="closeSettingsModal">✖</span>
      <h3><i class="fas fa-cog"></i> Settings</h3>
      
      <!-- Sound Settings - Marathon Theme Only -->
      <div class="settings-section" id="soundSettingsSection" style="display: none;">
        <h4>Sound</h4>
        <div class="settings-actions">
          <label class="sound-toggle-label">
            <input type="checkbox" id="soundToggleCheckbox" checked>
            <span class="sound-toggle-text"><i class="fas fa-volume-up"></i> Sound Effects</span>
          </label>
        </div>
      </div>
      
      <!-- Snow Settings - Christmas Theme Only -->
      <div class="settings-section" id="snowSettingsSection" style="display: none;">
        <h4><i class="fas fa-snowflake"></i> Snow Effect</h4>
        <div class="settings-actions">
          <label class="snow-level-label">Snow Intensity</label>
          <select id="snowLevelSelect" class="snow-level-select">
            <option value="off">Off</option>
            <option value="light">Light</option>
            <option value="medium" selected>Medium</option>
            <option value="heavy">Heavy</option>
            <option value="blizzard">Blizzard</option>
          </select>
        </div>
      </div>
      
      <div class="settings-section">
        <h4>Clear Data</h4>
        <p class="note">// Warning: These actions cannot be undone</p>
        
        <div class="settings-actions">
          <button class="btn danger" id="clearChatBtn">
            <i class="fas fa-comments"></i> Clear All Chat Messages
          </button>
          <button class="btn danger" id="clearPhotosBtn">
            <i class="fas fa-images"></i> Clear All Photos
          </button>
          <button class="btn danger" id="clearClipsBtn">
            <i class="fas fa-video"></i> Clear Uploaded Clips
          </button>
          <button class="btn danger" id="clearAllBtn">
            <i class="fas fa-trash-alt"></i> Clear Everything
          </button>
        </div>
      </div>
      
      <div class="settings-section">
        <h4>Account</h4>
        <button class="btn" id="logoutSettingsBtn">
          <i class="fas fa-sign-out-alt"></i> Switch User
        </button>
        <button class="btn" id="resetGiftBtn" style="margin-top: 10px;">
          <i class="fas fa-gift"></i> Preview Gift Experience
        </button>
      </div>
    </div>
  </div>

  <!-- =============================================
       PLANNING BOARD SYSTEM
       ============================================= -->
  
  <!-- Planning Board Boot Screen -->
  <div class="pb-boot-screen hidden" id="pbBootScreen">
    <div class="pb-boot-content">
      <div class="pb-boot-title">PLANNING_BOARD_2026.EXE</div>
      <div class="pb-boot-line"></div>
      <div class="pb-boot-log" id="pbBootLog"></div>
      <div class="pb-boot-progress">
        <div class="pb-boot-progress-bar" id="pbBootProgressBar"></div>
      </div>
      <div class="pb-boot-status" id="pbBootStatus">Initializing...</div>
    </div>
  </div>

  <!-- Planning Board Main Interface -->
  <div class="planning-board-overlay hidden" id="planningBoardOverlay">
    <div class="planning-board">
      <!-- Header -->
      <div class="pb-header">
        <div class="pb-header-left">
          <h1 class="pb-title">[▸] PLANNING_BOARD_2026.EXE</h1>
          <p class="pb-subtitle">// Interactive Year Planning System - Ideas → Plan → Missions</p>
        </div>
        <div class="pb-header-right">
          <button class="btn pb-bug-btn" id="pbBugReport" title="Report a bug">
            <i class="fas fa-bug"></i>
          </button>
          <button class="btn pb-close-btn" id="closePlanningBoard">
            <span>✕</span> CLOSE APPLICATION
          </button>
        </div>
      </div>
      
      <!-- Close Effect Overlay -->
      <div class="pb-close-effect hidden" id="pbCloseEffect">
        <div class="pb-close-effect-content">
          <div class="pb-close-glitch" id="pbCloseGlitch">TERMINATING...</div>
        </div>
      </div>

      <!-- Stats Bar -->
      <div class="pb-stats">
        <div class="pb-stat-card">
          <div class="pb-stat-value" id="pbStatTotal">0</div>
          <div class="pb-stat-label">Total Ideas</div>
        </div>
        <div class="pb-stat-card">
          <div class="pb-stat-value" id="pbStatThisMonth">0</div>
          <div class="pb-stat-label">This Month</div>
        </div>
        <div class="pb-stat-card">
          <div class="pb-stat-value" id="pbStatHighPriority">0</div>
          <div class="pb-stat-label">High Priority</div>
        </div>
        <div class="pb-stat-card">
          <div class="pb-stat-value" id="pbStatUnplanned">0</div>
          <div class="pb-stat-label">Unplanned</div>
        </div>
      </div>

      <!-- Quick Add Section -->
      <div class="pb-quick-add">
        <input type="text" class="pb-quick-input" id="pbQuickInput" placeholder="Type your idea and press Enter...">
        <div class="pb-quick-buttons">
          <button class="btn pb-add-simple" id="pbAddSimple">+ Add Simple Idea</button>
          <button class="btn pb-add-detailed" id="pbAddDetailed">✎ Add Detailed Idea</button>
        </div>
      </div>

      <!-- Month Card Navigator -->
      <div class="pb-month-navigator">
        <button class="pb-nav-arrow pb-nav-prev" id="pbNavPrev" disabled>
          <span>◀</span>
        </button>
        
        <div class="pb-card-container" id="pbCardContainer">
          <!-- Cards rendered by JS -->
        </div>
        
        <button class="pb-nav-arrow pb-nav-next" id="pbNavNext">
          <span>▶</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Expanded Idea View (Code Streaming) -->
  <div class="pb-idea-expanded hidden" id="pbIdeaExpanded">
    <div class="pb-idea-expanded-inner">
      <div class="pb-code-stream" id="pbCodeStream"></div>
      <div class="pb-expanded-content" id="pbExpandedContent"></div>
      <button class="pb-expanded-close" id="pbExpandedClose">✕ CLOSE</button>
    </div>
  </div>

  <!-- Add Detailed Idea Modal -->
  <div class="modal pb-modal hidden" id="pbAddModal">
    <div class="modal-inner pb-modal-inner">
      <div class="pb-modal-header">
        <h3>[+] ADD NEW IDEA</h3>
        <button class="modal-close" id="pbModalClose">✕</button>
      </div>
      
      <form id="pbAddForm" class="pb-form">
        <div class="pb-form-row">
          <label><i class="fas fa-lightbulb"></i> TITLE *</label>
          <input type="text" id="pbFormTitle" required placeholder="What's the idea?">
        </div>
        
        <div class="pb-form-row">
          <label><i class="fas fa-align-left"></i> DESCRIPTION</label>
          <textarea id="pbFormDesc" rows="3" placeholder="Add more details..."></textarea>
        </div>
        
        <div class="pb-form-row pb-form-grid">
          <div>
            <label><i class="fas fa-calendar-alt"></i> TARGET MONTH</label>
            <select id="pbFormMonth">
              <option value="">Unplanned</option>
              <option value="Jan">January</option>
              <option value="Feb">February</option>
              <option value="Mar">March</option>
              <option value="Apr">April</option>
              <option value="May">May</option>
              <option value="Jun">June</option>
              <option value="Jul">July</option>
              <option value="Aug">August</option>
              <option value="Sep">September</option>
              <option value="Oct">October</option>
              <option value="Nov">November</option>
              <option value="Dec">December</option>
            </select>
          </div>
          <div>
            <label><i class="fas fa-exclamation-circle"></i> PRIORITY</label>
            <select id="pbFormPriority">
              <option value="low">Low</option>
              <option value="medium" selected>Medium</option>
              <option value="high">High</option>
            </select>
          </div>
        </div>
        
        <div class="pb-form-row pb-form-grid">
          <div>
            <label><i class="fas fa-map-marker-alt"></i> LOCATION</label>
            <input type="text" id="pbFormLocation" placeholder="Where?">
          </div>
          <div>
            <label><i class="fas fa-clock"></i> DATE & TIME</label>
            <input type="datetime-local" id="pbFormDatetime">
          </div>
        </div>
        
        <div class="pb-form-row">
          <label><i class="fas fa-tag"></i> TAG</label>
          <select id="pbFormTag">
            <option value="">None</option>
            <option value="date">date</option>
            <option value="travel">travel</option>
            <option value="food">food</option>
            <option value="cozy">cozy</option>
            <option value="romantic">romantic</option>
            <option value="fun">fun</option>
            <option value="culture">culture</option>
            <option value="home">home</option>
            <option value="tradition">tradition</option>
            <option value="music">music</option>
            <option value="new">new</option>
            <option value="heart">heart</option>
            <option value="custom">Custom...</option>
          </select>
        </div>
        
        <div class="pb-form-row hidden" id="pbCustomTagField">
          <label>CUSTOM TAG</label>
          <input type="text" id="pbCustomTagInput" placeholder="Enter custom tag">
        </div>
        
        <div class="pb-form-row">
          <label><i class="fas fa-users"></i> PEOPLE TO INVITE</label>
          <div class="pb-people-input-container">
            <input type="text" id="pbFormPeopleInput" placeholder="Type name and press Enter">
            <div class="pb-people-tags" id="pbPeopleTags"></div>
          </div>
        </div>
        
        <div class="pb-form-row">
          <label><i class="fas fa-camera"></i> PHOTOS / ATTACHMENTS</label>
          <div class="pb-photo-upload" id="pbPhotoUpload">
            <div class="pb-photo-dropzone" id="pbPhotoDropzone">
              <span><i class="fas fa-cloud-upload-alt"></i> Click or drag photos here</span>
              <input type="file" id="pbPhotoInput" multiple accept="image/*" hidden>
            </div>
            <div class="pb-photo-previews" id="pbPhotoPreviews"></div>
          </div>
        </div>
        
        <div class="pb-form-actions">
          <button type="button" class="btn" id="pbFormCancel">Cancel</button>
          <button type="submit" class="btn pb-form-submit">Save Idea</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Bug Report Modal -->
  <div class="modal pb-modal hidden" id="pbBugModal">
    <div class="modal-inner pb-modal-inner pb-bug-modal-inner">
      <div class="pb-modal-header">
        <h3><i class="fas fa-bug"></i> REPORT A BUG</h3>
        <button class="modal-close" id="pbBugModalClose">✕</button>
      </div>
      
      <form id="pbBugForm" class="pb-form">
        <div class="pb-form-row">
          <label><i class="fas fa-heading"></i> ISSUE TITLE *</label>
          <input type="text" id="pbBugTitle" required placeholder="Brief description of the bug">
        </div>
        
        <div class="pb-form-row">
          <label><i class="fas fa-align-left"></i> DESCRIPTION *</label>
          <textarea id="pbBugDesc" rows="4" required placeholder="What happened? What did you expect to happen?"></textarea>
        </div>
        
        <div class="pb-form-row">
          <label><i class="fas fa-list-ol"></i> STEPS TO REPRODUCE</label>
          <textarea id="pbBugSteps" rows="3" placeholder="1. Go to...&#10;2. Click on...&#10;3. See error..."></textarea>
        </div>
        
        <div class="pb-form-row pb-form-grid">
          <div>
            <label><i class="fas fa-mobile-alt"></i> DEVICE</label>
            <select id="pbBugDevice">
              <option value="desktop">Desktop</option>
              <option value="mobile">Mobile</option>
              <option value="tablet">Tablet</option>
            </select>
          </div>
          <div>
            <label><i class="fas fa-palette"></i> THEME</label>
            <select id="pbBugTheme">
              <option value="system">System</option>
              <option value="light">Light</option>
              <option value="dark">Dark</option>
              <option value="christmas">Christmas</option>
            </select>
          </div>
        </div>
        
        <div class="pb-form-actions">
          <button type="button" class="btn" id="pbBugCancel">Cancel</button>
          <button type="submit" class="btn pb-form-submit">Submit Report</button>
        </div>
      </form>
      
      <p class="pb-bug-note">// Bug reports help me improve the app!</p>
    </div>
  </div>

  <!-- Import from Planning Board Modal -->
  <div class="modal hidden" id="importPBModal">
    <div class="modal-inner pb-modal-inner">
      <div class="pb-modal-header">
        <h3><i class="fas fa-download"></i> IMPORT FROM PLANNING BOARD</h3>
        <button class="modal-close" id="importPBModalClose">✕</button>
      </div>
      
      <div class="pb-import-content">
        <p class="note">// Select an idea to import as a mission</p>
        <div class="pb-import-list" id="pbImportList">
          <!-- Ideas will be rendered here -->
        </div>
        <p class="pb-import-empty hidden" id="pbImportEmpty">No ideas in Planning Board yet. Open the Planning Board to add some!</p>
      </div>
    </div>
  </div>

  <!-- Gift Experience for Kylee - 3D Isometric Box -->
  <div class="gift-overlay" id="giftOverlay">
    <div class="gift-scene">
      <div class="gift-floor">
        <!-- Shadows -->
        <div class="gift-shadow gift-shadow-1"></div>
        <div class="gift-shadow gift-shadow-2"></div>
        <div class="gift-shadow gift-shadow-3"></div>
        
        <!-- 3D Box -->
        <div class="gift-box-3d">
          <!-- Floating Heart (appears when opened) -->
          <div class="gift-domo">
            <span class="domo-icon">❤️</span>
          </div>
          
          <!-- The Lid -->
          <div class="gift-lid">
            <div class="gift-qmark">?</div>
            <div class="gift-face lid-top"></div>
            <div class="gift-face lid-left"></div>
            <div class="gift-face lid-right"></div>
          </div>
          
          <!-- Box faces -->
          <div class="gift-face top"></div>
          <div class="gift-face left"></div>
          <div class="gift-face right"></div>
        </div>
        
        <!-- Gift Tag -->
        <div class="gift-tag-3d">
          <span class="tag-to">To: Kylee</span>
          <span class="tag-from">From: Yasir</span>
        </div>
        
        <!-- Click hint -->
        <p class="gift-click-hint">tap to open</p>
      </div>
    </div>
    
    <!-- Terminal Card (Retro style) -->
    <div class="gift-terminal">
      <div class="terminal-scanline"></div>
      <div class="code-rain" id="codeRain"></div>
      <div class="terminal-header">
        <span class="terminal-title">LOVE.exe</span>
        <span class="terminal-date">12.25.2025</span>
      </div>
      <div class="terminal-content" id="terminalContent">
        <div class="floating-code">&lt;3 { happiness: infinite; }</div>
        
        <p class="terminal-greeting">Pwincess,<span class="terminal-cursor"></span></p>
        
        <p class="terminal-message">Wishing you joy, warmth, and all the best into the new year ahead.</p>
        
        <div class="terminal-signature">
          With all my love,
          <span class="name">Yasir</span>
        </div>
        
        <button class="terminal-btn" id="giftContinueBtn">[ Open Your Gift ]</button>
      </div>
    </div>
  </div>

  <link rel="stylesheet" href="gift.css">
  
  <!-- Floating Bug Report Button -->
  <button class="fab-bug-report" id="fabBugReport" title="Report a Bug">
    <i class="fas fa-bug"></i>
  </button>
  
  <script src="confetti.js"></script>
  <script src="app.js" defer></script>
</body>
</html>